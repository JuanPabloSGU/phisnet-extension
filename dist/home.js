(()=>{"use strict";let e=[];document.addEventListener("DOMContentLoaded",(()=>{chrome.storage.local.get(["jwt","token"],(e=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError.message);else{const o=e.jwt,n=e.token;o&&n||(window.location.href="popup.html")}}));const o=document.getElementById("user-info"),n=document.getElementById("logout"),t=document.getElementById("phishing-form"),r=document.getElementById("phishing-list");chrome.runtime.sendMessage({action:"getToken"},(e=>{const n=e.token;n&&fetch("https://zitadel.databending.ca/oidc/v1/userinfo",{method:"GET",headers:{Authorization:`Bearer ${n}`}}).then((e=>e.json())).then((e=>{console.log("User info:",e),o.innerHTML=`\n                        <p><strong>Name:</strong> ${e.name}</p>\n          <p><strong>Email:</strong> ${e.email}</p>\n                        <p><strong>Subject:</strong> ${e.sub}</p>\n                    `})).catch((e=>{console.error("Error fetching user info:",e),o.innerHTML="<p>Error fetching user info</p>"}))})),t.addEventListener("submit",(o=>{o.preventDefault();const n=o.target.url.value;n?chrome.runtime.sendMessage({action:"getJWT"},(o=>{const t=o.jwt;t?fetch("http://localhost:5000/api/v1/llm_mock",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({url:n})}).then((e=>e.json())).then((o=>{console.log("Data from server:",o),e.push({url:n,score:o.message}),e.forEach((e=>{const o=e.url,n=e.score,t=document.createElement("div");t.innerHTML=`\n                                <p><strong>URL:</strong> ${o}</p>\n                                <p><strong>Score:</strong> ${n}</p>\n                            `,r.appendChild(t)}))})).catch((e=>{console.error("Error fetching data:",e)})):console.error("JWT is empty")})):console.error("URL is empty")})),chrome.runtime.sendMessage({action:"getLinks"},(o=>{const n=o.links;n?(e=n,e.forEach((e=>{const o=e.url,n=e.score,t=document.createElement("div");t.innerHTML=`\n                    <p><strong>URL:</strong> ${o}</p>\n                    <p><strong>Score:</strong> ${n}</p>\n                `,r.appendChild(t)}))):console.error("Links are empty")})),n.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"clearToken"},(e=>{const o=e.message;o?chrome.storage.local.clear().then((()=>{console.log("Token cleared:",o),chrome.action.setPopup({popup:"popup.html"}),window.location.href="popup.html"})):console.error("Error clearing token")}))}))}))})();